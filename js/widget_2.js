var ut=Object.defineProperty,pt=Object.defineProperties;var ht=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,St=Object.prototype.propertyIsEnumerable;var j=(n,e,t)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,T=(n,e)=>{for(var t in e||(e={}))gt.call(e,t)&&j(n,t,e[t]);if(x)for(var t of x(e))St.call(e,t)&&j(n,t,e[t]);return n},O=(n,e)=>pt(n,ht(e));var p=(n,e,t)=>j(n,typeof e!="symbol"?e+"":e,t);var S=(n,e,t)=>new Promise((s,r)=>{var a=c=>{try{o(t.next(c))}catch(h){r(h)}},i=c=>{try{o(t.throw(c))}catch(h){r(h)}},o=c=>c.done?s(c.value):Promise.resolve(c.value).then(a,i);o((t=t.apply(n,e)).next())});import{i as et,g as nt,a as st,l as y,b as A,_ as f,W as at,c as K,d as _t}from"./59bba2ffc3/widget-loader.dl3yrYf6.js";import{s as rt,g as mt,a as yt,b as ft,c as Et,d as It,e as At,f as wt,O as w,z as l,h as Q,E as X}from"./59bba2ffc3/index.BEe-NqBR.js";import{C as Tt,D as bt,T as Ot,g as Pt}from"./59bba2ffc3/tryon.C1XEPkyV.js";import{g as Ct}from"./59bba2ffc3/page.util.CCYm5CHr.js";import{g as it}from"./59bba2ffc3/font.utils.1AcYFt-O.js";import{W as N}from"./59bba2ffc3/widget-call-back-url.DWkw0ury.js";const Ut={PRODUCT_TILE:"tolstoy-product-tile"},he="./styles/product-tile.css",ge="w-full",vt="tolstoy-collection-page-tile",Se="./styles/collection-page-tile.css",_e={display:"flex",width:"100%",height:"100%",position:"relative"},Lt=(n,e)=>S(void 0,null,function*(){var a,i;const s=rt()&&et()?nt():st(),r=new URLSearchParams;r.set("productId",n),r.set("appKey",e);try{const o=yield fetch(`${s}/settings/widget/get-product-gallery-config?${r}`);y({windowShopify:(a=window.Shopify)==null?void 0:a.shop});const c=[...document.querySelectorAll("script[data-shop]")].map(g=>{var m;return(m=g==null?void 0:g.dataset)==null?void 0:m.shop}).find(Boolean);y({appDataShop:c});const h=c||((i=window.Shopify)==null?void 0:i.shop),u=yield o.json();return u.projects&&(u.projects=u.projects.filter(g=>g.appUrl===h)),u}catch(o){return A(o,"Error getting collection page tile config"),null}}),Rt=()=>{var e;const n=window.Shopify;return(e=n==null?void 0:n.theme)==null?void 0:e.theme_store_id};function Dt(n){function e(){r&&(t.length>0&&/^[~+>]$/.test(t[t.length-1])&&t.push(" "),t.push(r))}var t=[],s,r,a,i=[0],o=0,c,h=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,u=/^\s+$/,g=[/\s+|\/\*|["'>~+[(]/g,/\s+|\/\*|["'[\]()]/g,/\s+|\/\*|["'[\]()]/g,null,/\*\//g];for(n=n.trim();;)if(r="",a=g[i[i.length-1]],a.lastIndex=o,s=a.exec(n),s)if(c=o,o=a.lastIndex,c<o-s[0].length&&(r=n.substring(c,o-s[0].length)),i[i.length-1]<3){if(e(),s[0]==="[")i.push(1);else if(s[0]==="(")i.push(2);else if(/^["']$/.test(s[0]))i.push(3),g[3]=new RegExp(s[0],"g");else if(s[0]==="/*")i.push(4);else if(/^[\])]$/.test(s[0])&&i.length>0)i.pop();else if(/^(?:\s+|[~+>])$/.test(s[0])&&(t.length>0&&!u.test(t[t.length-1])&&i[i.length-1]===0&&t.push(" "),i[i.length-1]===1&&t.length===5&&t[2].charAt(t[2].length-1)==="="&&(t[4]=" "+t[4]),u.test(s[0])))continue;t.push(s[0])}else t[t.length-1]+=r,h.test(t[t.length-1])&&(i[i.length-1]===4&&(t.length<2||u.test(t[t.length-2])?t.pop():t[t.length-1]=" ",s[0]=""),i.pop()),t[t.length-1]+=s[0];else{r=n.substr(o),e();break}return t.join("").trim()}function ot(n,e=document,t=null){return Bt(n,!0,e,t)}function Bt(n,e,t,s=null){return n=Dt(n),t.querySelector(n),document.head.createShadowRoot||document.head.attachShadow?M(n,",").reduce((a,i)=>{const o=M(i.replace(/^\s+/g,"").replace(/\s*([>+~]+)\s*/g,"$1")," ").filter(m=>!!m).map(m=>M(m,">")),c=o.length-1,h=o[c][o[c].length-1],u=Gt(h,t,s),g=Wt(o,c,t);return a=a.concat(u.filter(g)),a},[]):t.querySelectorAll(n)}function Wt(n,e,t){return s=>{let r=e,a=s,i=!1;for(;a&&!Nt(a);){let o=!0;if(n[r].length===1)o=a.matches(n[r]);else{const c=[].concat(n[r]).reverse();let h=a;for(const u of c){if(!h||!h.matches(u)){o=!1;break}h=J(h,t)}}if(o&&r===0){i=!0;break}o&&r--,a=J(a,t)}return i}}function M(n,e){return n.match(/\\?.|^$/g).reduce((t,s)=>(s==='"'&&!t.sQuote?(t.quote^=1,t.a[t.a.length-1]+=s):s==="'"&&!t.quote?(t.sQuote^=1,t.a[t.a.length-1]+=s):!t.quote&&!t.sQuote&&s===e?t.a.push(""):t.a[t.a.length-1]+=s,t),{a:[""]}).a}function Nt(n){return n.nodeType===Node.DOCUMENT_FRAGMENT_NODE||n.nodeType===Node.DOCUMENT_NODE}function J(n,e){const t=n.parentNode;return t&&t.host&&t.nodeType===11?t.host:t===e?null:t}function Gt(n=null,e,t=null){let s=[];if(t)s=t;else{const r=function(a){for(let i=0;i<a.length;i++){const o=a[i];s.push(o),o.shadowRoot&&r(o.shadowRoot.querySelectorAll("*"))}};e.shadowRoot&&r(e.shadowRoot.querySelectorAll("*")),r(e.querySelectorAll("*"))}return n?s.filter(r=>r.matches(n)):s}const Vt="#tolstoy-video-preview",kt="thumbnail.0000000000",Kt="_ai-preview_",jt=".product__media, .product-single__thumbnails, .gallery, .product-gallery, .slider, .carousel, section.product",Mt=n=>[...jt.split(",").map(e=>e.trim()).filter(Boolean),"body"].map(e=>`${e} :has(${n})`).join(","),Yt=n=>{var e,t,s;return((e=n==null?void 0:n.alt)==null?void 0:e.includes(Vt))||((t=n==null?void 0:n.src)==null?void 0:t.includes(kt))||((s=n==null?void 0:n.src)==null?void 0:s.includes(Kt))},me=(n,e,t)=>{const s=e.split(",").flatMap(a=>[a,`${a} img`]).join(",");return[...t?ot(s):document.querySelectorAll(s)].some(a=>a.contains(n))};function ye(n,e,t){const s=t||Mt(n),r=document.querySelector(s);return r?Array.from(e?ot(n,r):r.querySelectorAll(n)):[]}const qt=()=>{var s,r,a;const n=(s=document.querySelector("script[data-product-id]"))==null?void 0:s.getAttribute("data-product-id"),e=(r=document.querySelector("script[data-app-key]"))==null?void 0:r.getAttribute("data-app-key"),t=(a=document.querySelector("script[data-product-gallery-projects]"))==null?void 0:a.getAttribute("data-product-gallery-projects");return{productId:n,appKey:e,productGalleryProjects:t}},Z=(n,e)=>S(void 0,null,function*(){if(n){const{initThumbnailAnchorImageDetection:s}=yield f(()=>S(void 0,null,function*(){const{initThumbnailAnchorImageDetection:r}=yield import("./59bba2ffc3/thumbnail-anchor-image-detection.utils.NUg66-kM.js");return{initThumbnailAnchorImageDetection:r}}),[]);return s(e)}const{initFallbackImageDetection:t}=yield f(()=>S(void 0,null,function*(){const{initFallbackImageDetection:s}=yield import("./59bba2ffc3/fallback-image-detection.utils.CJrkT0Y1.js");return{initFallbackImageDetection:s}}),[]);return t(e)}),Ft=()=>S(void 0,null,function*(){var n,e,t,s,r;try{let a;y("init product gallery");const{productId:i,appKey:o,productGalleryProjects:c}=qt();if(!i||!o)return;try{const _=JSON.parse(c);if(y({productGalleryProjects:_}),!(_!=null&&_.length))return}catch(_){A({error:_.message});return}if(a=yield Lt(i,o),!((n=a==null?void 0:a.product)!=null&&n.images)||!((e=a==null?void 0:a.projects)!=null&&e.length)||!((t=a==null?void 0:a.vodAssets)!=null&&t.length)&&!Object.keys((s=a==null?void 0:a.vodAssets)!=null?s:{}).length)return;const h=a.product.images.map(_=>_.src),u=Rt();if(y("themeId",u),u){const{themeContainerClasses:_}=yield f(()=>S(void 0,null,function*(){const{themeContainerClasses:v}=yield import("./59bba2ffc3/theme-classes-extractor.BVNtrPL4.js");return{themeContainerClasses:v}}),[]),b=_[u];if(b){const{variantSelector:v,mainGallerySelector:L,thumbnailSelector:R}=b;y("config from theme",{themeId:u,variantSelector:v,mainGallerySelector:L,thumbnailSelector:R});const I=((r=a.projects[0])==null?void 0:r.playerSettings)||{};if(I.useNativePlayer)return;I.galleryImageSelector=I.galleryImageSelector||L,I.galleryThumbnailSelector=I.galleryThumbnailSelector||R}}const g=new URLSearchParams(location.search).get("test-gallery");if(g){const{renderTestGalleryIfNeeded:_}=yield f(()=>S(void 0,null,function*(){const{renderTestGalleryIfNeeded:b}=yield import("./59bba2ffc3/render-test-gallery.C2MSMgYs.js");return{renderTestGalleryIfNeeded:b}}),[]);_(g,h)}const m=a.product.images.some(Yt);y({hasThumbnailAnchorImage:m});let U=()=>{};const k=!Array.isArray(a==null?void 0:a.vodAssets)&&Object.keys(a.vodAssets).length>0;if(y({hasConfigVariants:k,vodAssets:a.vodAssets}),k){const _=()=>S(void 0,null,function*(){try{const L=new URLSearchParams(location.search).get("variant"),R=document.querySelector('form[action="/cart/add"] [name="id"]'),I=parseInt(L||(R==null?void 0:R.value)||"NaN",10);if(y({message:"Current variant:",value:I}),U(),a!=null&&a.vodAssets[I]){const z=O(T({},a),{variant:I,vodAssets:a==null?void 0:a.vodAssets[I],appKey:o});y({clientConfig:z}),U=yield Z(m,z)}else U=()=>{}}catch(L){A({error:L})}});let b=window.location.search;const v=new MutationObserver(()=>{window.location.search!==b&&(b=window.location.search,_())});return v.observe(document,{subtree:!0,childList:!0}),_(),()=>{v.disconnect(),U()}}else return yield Z(m,O(T({},a),{appKey:o}))}catch(a){A(a,"Error initializing product gallery video")}}),ct="shop-assistant-container",lt={flexGrow:1,width:"100%"},Ht="https://rubkik.gotolstoy.com",D={appKey:"app_key",appUrl:"app_url",productId:"product_id",collectionId:"collection_id",aiShopperWidget:"ai_shopper_widget"},$t=["on-you","top-questions","search-bar"],V={isPreviewSite:()=>typeof window!="undefined"&&window.location.href.includes(Ht),getSettings:()=>{const n=new URLSearchParams(typeof window!="undefined"?window.location.search:"");return!V.isPreviewSite()||!$t.includes(n.get(D.aiShopperWidget)||"")?{}:{appKey:n.get(D.appKey),appUrl:n.get(D.appUrl),productId:n.get(D.productId),collectionId:n.get(D.collectionId),aiShopperWidget:n.get(D.aiShopperWidget)}}},G=class G{constructor(){p(this,"initialized",!1);p(this,"initializedPromise",null);p(this,"accountSettings",null);p(this,"appKey");p(this,"appUrl");p(this,"productId");p(this,"collectionId");p(this,"shouldUseCache");p(this,"cacheVersion");p(this,"aiShopperWidget");if(G.instance)return G.instance;G.instance=this;const e=V.getSettings();this.appKey=e.appKey||mt()||"",this.appUrl=e.appUrl||yt(),this.productId=e.productId||ft(),this.collectionId=e.collectionId||Et(),this.aiShopperWidget=e.aiShopperWidget||null,this.shouldUseCache=rt(),this.cacheVersion=It()}loadAccountSettingsFromV1Widget(){return S(this,null,function*(){try{let e=0;for(;e<5;){if(window.widget_V1_AccountSettingsPromise)return yield window.widget_V1_AccountSettingsPromise;e++,yield new Promise(t=>setTimeout(t,200))}return null}catch(e){return A("[TolstoySettings:loadAccountSettingsFromV1Widget] error loading account settings:",e),null}})}initAccountSettings(){return S(this,null,function*(){var e,t;if(!this.accountSettings){if(this.accountSettings=yield this.loadAccountSettingsFromV1Widget(),!this.accountSettings)try{const s=this.shouldUseCache&&et()?nt():st(),r=new URL(`${s}/actions/accounts/${this.appKey}`);this.cacheVersion&&r.searchParams.set("v",this.cacheVersion),this.appUrl&&r.searchParams.set("appUrl",this.appUrl);const a=yield fetch(r.toString());this.accountSettings=yield a.json()}catch(s){A("[TolstoySettings:initAccountSettings] error loading account settings:",s);return}this.shouldUseCache=this.shouldUseCache||((e=this.accountSettings)==null?void 0:e.shouldUseCache)||!1,this.cacheVersion=this.cacheVersion||((t=this.accountSettings)==null?void 0:t.cacheVersion)||null}})}get shopAssistantEnabled(){if(!this.initialized||!this.accountSettings)return!1;const e=At();return y("[TolstoySettings:shopAssistantEnabled] shopify metadata",e),typeof e=="boolean"?e:(y("[TolstoySettings:shopAssistantEnabled] account settings",this.accountSettings.hasLiveShopAssistant),this.accountSettings.hasLiveShopAssistant)}get searchBarWidgetEnabled(){if(!this.initialized||!this.accountSettings)return!1;if(this.aiShopperWidget)return this.aiShopperWidget==="search-bar";const e=wt();return y("[TolstoySettings:searchBarWidgetEnabled] shopify metadata",e),typeof e=="boolean"?e:!1}init(){return S(this,null,function*(){if(!this.initialized){if(this.initializedPromise){yield this.initializedPromise;return}if(!this.appKey){A("[TolstoySettings:init] appKey is missing",{appKey:this.appKey,appUrl:this.appUrl});return}this.initializedPromise=this.initAccountSettings(),yield this.initializedPromise,this.initialized=!0}})}};p(G,"instance",null);let F=G;const d=new F;class ${static cleanUrl(e=window.location.href){const t=new URL(e);return t.searchParams.delete("authToken"),Object.values(E).forEach(s=>{t.searchParams.delete(s)}),t.searchParams.delete(N.callbackActionParam),t.toString()}static cleanBrowserHistory(){const e=$.cleanUrl();e!==window.location.href&&window.history.replaceState({},document.title,e)}}const E={autoOpenShopAssistant:"autoOpenShopAssistant",autoOpenSearchBar:"autoOpenSearchBar",autoOpenTopQuestions:"autoOpenTopQuestions",autoOpenSeeItOnYou:"autoOpenSeeItOnYou",autoOpenProductId:"autoOpenProductId"};class P{static handleWidgetCallbackUrl(e=window.location.href){const t=new URL(e),s=Object.fromEntries(t.searchParams);return setTimeout(()=>{$.cleanBrowserHistory()},200),{autoOpenShopAssistant:t.searchParams.get(E.autoOpenShopAssistant)==="true",autoOpenSearchBar:t.searchParams.get(E.autoOpenSearchBar)==="true",autoOpenTopQuestions:t.searchParams.get(E.autoOpenTopQuestions)==="true",autoOpenSeeItOnYou:t.searchParams.get(E.autoOpenSeeItOnYou)==="true",autoOpenProductId:t.searchParams.get(E.autoOpenProductId),urlParams:s}}static extractAuthToken(e={}){return e.authToken}}p(P,"seeItOnYouCallbackUrl",new N({[E.autoOpenSeeItOnYou]:"true"})),p(P,"shopAssistantCallbackUrl",new N({[E.autoOpenShopAssistant]:"true"})),p(P,"searchBarCallbackUrl",new N({[E.autoOpenSearchBar]:"true"})),p(P,"topQuestionsCallbackUrl",new N({[E.autoOpenTopQuestions]:"true"})),p(P,"productIdCallbackUrl",e=>new N({[E.autoOpenProductId]:e}));const Y="assistant-agent-root",zt=()=>S(void 0,null,function*(){var n,e;try{if(yield d.init(),!d.shopAssistantEnabled){w.log("AssistantAgentController: Shop assistant is disabled");return}if(!d.appUrl){w.log("AssistantAgentController: Invalid app url",d.appUrl);return}const t=yield Tt.getShopAssistantConfig({appUrl:d.appUrl});if(!(t!=null&&t.widgetSettings)){w.log("Invalid shop assistant config",t);return}if(!t.widgetSettings.enabled){w.log("Shop assistant is disabled in config");return}const{displayOnPages:s}=t.widgetSettings;y("displayOnPages",s);const r=Ct({productId:d.productId,collectionId:d.collectionId});if(!(s!=null&&s.includes(r))){w.log(`Shop assistant not configured to display on ${r} pages`);return}let a=document.getElementById(Y);a||(a=document.createElement("div"),a.id=Y,document.body.appendChild(a));const[{default:i},{default:o},{default:c}]=yield Promise.all([f(()=>import("./59bba2ffc3/shop-assistant-app.I412Cy81.js"),[]),f(()=>import("./59bba2ffc3/render.utils.B5--PcUE.js").then(m=>m.a),[]),f(()=>import("./59bba2ffc3/shop-assistant.BDAyl_xB.js"),[])]),{autoOpenShopAssistant:h,urlParams:u}=P.handleWidgetCallbackUrl(),g={appKey:d.appKey,appUrl:d.appUrl,pageProductId:d.productId,pageCollectionId:d.collectionId,agentImage:t.agentSettings.agentImage,brandLogo:((n=t==null?void 0:t.brandSettings)==null?void 0:n.brandLogo)||"",hidePoweredBy:t==null?void 0:t.hidePoweredBy,floatingWidgetSettings:(e=t==null?void 0:t.widgetSettings)==null?void 0:e.floatingWidgetSettings,preloadedStyles:c,skills:t.skills,tryonSettings:bt,autoOpen:h,urlParams:u};yield o(i,O(T({},g),{element:a,hasStyledComponents:!0,widgetKey:at.SHOP_ASSISTANT_BUBBLE,containerClasses:ct,containerStyles:lt,fontFamily:it(document.body),preloadedStyles:c})),a.setAttribute("data-status",K.SUCCESS)}catch(t){console.error("Error initializing Shop Assistant:",t),A("Error initializing Shop Assistant",t);const s=document.getElementById(Y);s&&s.setAttribute("data-status",K.FAILED)}});var dt=(n=>(n.VirtualTryOn="VirtualTryOn",n.SignIn="SignIn",n.SizeGuideAssistance="SizeGuideAssistance",n.ConnectToSupport="ConnectToSupport",n.ProductRecommendations="ProductRecommendations",n.AddToCart="AddToCart",n.StylingAdvice="StylingAdvice",n.InventoryCheck="InventoryCheck",n.Quiz="Quiz",n))(dt||{});const xt=l.object({agentSettings:l.object({agentImage:l.string()}),brandSettings:l.object({brandLogo:l.string()}),hidePoweredBy:l.boolean(),skills:l.array(l.nativeEnum(dt))}),Qt=l.object({externalProductId:l.string(),title:l.string(),handle:l.string(),category:l.string(),thumbnailUrl:l.string().optional().nullable()}).nullable(),Xt=l.object({tryonSettings:Ot,shoppingAssistantConfig:xt,product:Qt}),Jt=l.object({placeholder:l.string()});l.object(O(T({settings:Jt,enabled:l.boolean()},Xt.shape),{product:l.object({externalProductId:l.string(),title:l.string(),handle:l.string(),category:l.string(),thumbnailUrl:l.string().optional().nullable()}).nullable()}));class Zt{constructor(){p(this,"getSearchBarConfig",e=>S(this,null,function*(){const t=new URLSearchParams(T({appUrl:e.appUrl,appKey:e.appKey},e.productId&&{productId:e.productId})),s=yield fetch(`${Pt()}/on-you/search-bar/getSearchBarSettings?${t.toString()}`);if(!s.ok)throw new Q(X.GETTING_SEARCH_BAR_CONFIG_FAILED,{details:"Failed to get search bar config",params:e,response:s});const r=yield s.json();if(!r||!r.settings)throw new Q(X.GETTING_SEARCH_BAR_CONFIG_FAILED,{details:"Invalid search bar config response format",params:e,response:s,data:r});return r}))}}const te=new Zt,ee={isPreviewSite:()=>V.isPreviewSite(),updatePreviewPage:n=>{if(V.isPreviewSite()&&n){if(n.thumbnailUrl){const e=document.querySelectorAll(".product__media img");if(e.length>0)for(const t of e)t.src=n.thumbnailUrl,t.srcset=n.thumbnailUrl}if(n.title){const e=document.querySelectorAll(".product__title h1");if(e.length>0)for(const t of e)t.textContent=n.title}}}},q="search-bar-root",ne=()=>S(void 0,null,function*(){var n,e,t,s,r,a;try{if(yield d.init(),d.aiShopperWidget&&d.aiShopperWidget!=="search-bar")return;if(!d.searchBarWidgetEnabled){w.log("SearchBarWidgetController: Search bar is disabled");return}if(!d.appUrl){w.log("SearchBarWidgetController: Invalid app url",d.appUrl);return}const i=yield te.getSearchBarConfig({appKey:d.appKey,appUrl:d.appUrl,productId:d.productId||void 0});if(!(i!=null&&i.enabled)){w.log("Search bar is disabled. Widget not paid");return}if(V.isPreviewSite()&&ee.updatePreviewPage(i.product),!i.settings){w.log("Search bar settings are missing");return}let o=document.getElementById(q);o||(o=document.createElement("div"),o.id=q,document.body.appendChild(o));const[{default:c},{default:h},{default:u}]=yield Promise.all([f(()=>import("./59bba2ffc3/search-bar-widget-app.DRck8o2p.js"),[]),f(()=>import("./59bba2ffc3/render.utils.B5--PcUE.js").then(k=>k.a),[]),f(()=>import("./59bba2ffc3/search-bar.BDAyl_xB.js"),[])]),{autoOpenSearchBar:g,urlParams:m}=P.handleWidgetCallbackUrl(),U={appKey:d.appKey,appUrl:d.appUrl,pageProductId:d.productId,pageCollectionId:d.collectionId,placeholder:i.settings.placeholder,agentImage:(e=(n=i.shoppingAssistantConfig)==null?void 0:n.agentSettings)==null?void 0:e.agentImage,brandLogo:((s=(t=i.shoppingAssistantConfig)==null?void 0:t.brandSettings)==null?void 0:s.brandLogo)||"",hidePoweredBy:(r=i.shoppingAssistantConfig)==null?void 0:r.hidePoweredBy,preloadedStyles:u,skills:(a=i.shoppingAssistantConfig)==null?void 0:a.skills,tryonSettings:i.tryonSettings,autoOpen:g,urlParams:m};yield h(c,O(T({},U),{element:o,hasStyledComponents:!0,widgetKey:at.SEARCH_BAR,containerClasses:ct,containerStyles:lt,fontFamily:it(document.body),preloadedStyles:u})),o.setAttribute("data-status",K.SUCCESS)}catch(i){console.error("Error initializing Search Bar:",i),A("Error initializing Search Bar",i);const o=document.getElementById(q);o&&o.setAttribute("data-status",K.FAILED)}}),se={PRODUCT_TILE:{key:Ut.PRODUCT_TILE,controller:()=>f(()=>import("./59bba2ffc3/product-tiles-controller.DIpJ5qcY.js"),[])},COLLECTION_PAGE_TILE:{key:vt,controller:()=>f(()=>import("./59bba2ffc3/collection-page-tile-controller.BzhmOr7m.js"),[])},TOP_QUESTIONS:{key:"top-questions",controller:()=>f(()=>import("./59bba2ffc3/top-questions-controller.D1JuaZ6L.js"),[])},SEE_IT_ON_YOU:{key:"see-it-on-you",controller:()=>f(()=>import("./59bba2ffc3/see-it-on-you-controller.CYwfpokB.js"),[])}},ae={PRODUCT_GALLERY_VIDEO:{init:Ft},SHOP_ASSISTANT:{init:zt},SEARCH_BAR:{init:ne}},B={SUBSCRIBE:"TOLSTOY_WIDGET_V2_SUBSCRIBE",MESSAGE:"TOLSTOY_WIDGET_V2_MESSAGE"},W={ADD_TO_CART:"tolstoy_add_to_cart",SPOTLIGHT_QUICK_SHOP:"tolstoy_spotlight_carousel_quick_shop_click",PRODUCT_CARD_CLICK:"tolstoy_product_card_click"},C=class C{constructor(){p(this,"subscribers");p(this,"eventsStatus");p(this,"handleMessage",e=>{const{detail:t}=e;if(t!=null&&t.eventName)switch(t.eventName){case W.ADD_TO_CART:case W.SPOTLIGHT_QUICK_SHOP:case W.PRODUCT_CARD_CLICK:this.subscribe(t.eventName,t.callback);break;default:this.notifySubscribers(t.eventName,t)}});this.subscribers=new Map,this.eventsStatus={[W.ADD_TO_CART]:!1,[W.SPOTLIGHT_QUICK_SHOP]:!1,[W.PRODUCT_CARD_CLICK]:!1}}static getInstance(){return C.instance||(C.instance=new C),C.instance}formatMessage(e){return O(T({},e),{transmissionId:e.transmissionId||"widget-v2",timestamp:Date.now()})}updateEventStatus(e,t){e in this.eventsStatus&&(this.eventsStatus[e]=t)}isEventSubscribed(e){return this.eventsStatus[e]||!1}notifySubscribers(e,t){const s=this.subscribers.get(e);s==null||s.forEach(r=>{try{r(t)}catch(a){console.error(`Error in ${e} callback:`,a)}})}subscribe(e,t){var s;this.subscribers.has(e)||this.subscribers.set(e,new Set),(s=this.subscribers.get(e))==null||s.add(t),this.updateEventStatus(e,!0)}unsubscribe(e,t){const s=this.subscribers.get(e);s==null||s.delete(t),(s==null?void 0:s.size)===0&&this.updateEventStatus(e,!1)}postMessage(e){const t=this.formatMessage(e),s=new CustomEvent(B.MESSAGE,{detail:t});window.dispatchEvent(s)}init(){window.addEventListener(B.SUBSCRIBE,this.handleMessage),window.addEventListener(B.MESSAGE,this.handleMessage);const e=new CustomEvent(B.SUBSCRIBE);window.addEventListener("tolstoyWidgetReady",()=>{window.dispatchEvent(e)},{once:!0})}destroy(){window.removeEventListener(B.SUBSCRIBE,this.handleMessage),window.removeEventListener(B.MESSAGE,this.handleMessage)}};p(C,"instance");let H=C;const re=()=>{H.getInstance().init()},tt=()=>S(void 0,null,function*(){try{re(),yield _t(se,ae)}catch(n){A(n)}});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{tt()}):tt();export{Se as C,H as E,jt as G,he as P,ct as S,d as T,P as W,ge as a,_e as b,Xt as c,V as d,ee as e,lt as f,Vt as g,ye as h,Yt as i,me as j,ot as q};
